{%extends "newbase.html"%}
{%block pagetitle %} home {%endblock pagetitle %}
{% block content%}

<!-- {% if messages %}
<div class=" mt-32 text-center w-full">
    {% for message in messages %}
    <span class=" text-4xl text-gray-700 font-weight-bolder" >{{ message }}</span>
    {% endfor %}
</div>
{% endif %} -->
 <!-- CAROUSEL + FILTER FORM -->
 <section class="relative hidden sm:block w-full">
  <!-- Carousel Wrapper -->
  <div class="relative  ">
    <!-- Carousel Images -->
    <div class="carousel overflow-hidden h-64 sm:h-96 relative mb-12 sm:mb-0">
      <!-- Example carousel slides -->
      <div class="carousel-inner flex transition-transform duration-700 ease-in-out" style="transform: translateX(0%)">
        {% for ad in ads %}
        {%if ad.url %}
          <a href="{{ad.url}}" class=" w-full">
            <img class="w-full flex-shrink-0 object-cover" src="{{ad.file_path}}" alt="">
          </a>
        {%else%}
          <img class="w-full flex-shrink-0 object-cover" src="{{ad.file_path}}" alt="">
        {%endif%}
        {% endfor %}
      </div>
    </div>

    <!-- Filter form overlaid horizontally on carousel -->
    <form method="GET" action="{% url 'listings' %}" 
          class="absolute sm:bottom-8 sm:left-1/2 sm:transform sm:-translate-x-1/2 bg-white bg-opacity-90 rounded-xl shadow-lg flex flex-col sm:items-end sm:flex-row gap-3 py-3 px-4 max-w-5xl w-full sm:mx-4">
      <!-- City -->
      <div class="flex-1 min-w-[120px] custom-select-wrapper">
        <label for="city" class="block text-sm font-semibold text-lime-700 mb-1">City</label>
        <select id="city" name="city" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white py-2 text-gray-400 ">City</option>
          {% for city in cities %}
          <option value="{{ city }}"
           {% if request.GET.city == city|stringformat:"s" %}selected{% endif %}
           class="bg-white text-gray-700 hover:bg-gray-200">{{ city }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Subcity -->
      <div class="flex-1 min-w-[120px] custom-select-wrapper">
        <label for="subcity" class="block text-sm font-semibold text-lime-700 mb-1">Subcity</label>
        <select id="subcity" name="subcity" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white py-2 text-gray-400 ">Subcity</option>
          {% for subcity in subcities %}
          <option value="{{ subcity }}" 
           {% if request.GET.subcity == subcity|stringformat:"s" %}selected{% endif %}
           class="bg-white hover:bg-gray-200 {% if request.GET.subcity == subcity|stringformat:"s" %}text-black {% else %} text-gray-700 {% endif %}er:bg-gray-200 ">{{ subcity }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Price Range -->
      <div class="flex-1 min-w-[140px] custom-select-wrapper">
        <label for="price" class="block text-sm font-semibold text-lime-700 mb-1">Max Price</label>
        <select id="price" name="price" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white text-gray-400 hover:bg-gray-200">Price range</option>
          {% for key, value in price_ranges.items %}
          <option value="{{ key }}"
           {% if request.GET.price == key|stringformat:"s" %}selected{% endif %} 
           class="bg-white text-gray-700 hover:bg-gray-200">{{ value }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Bedrooms -->
      <div class="flex-1 min-w-[100px] custom-select-wrapper">
        <label for="bedrooms" class="block text-sm font-semibold text-lime-700 mb-1">Bedrooms</label>
        <select id="price" name="bedrooms" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white text-gray-400 hover:bg-gray-200">Bedrooms</option>
          {% for key, value in bedrooms.items %}
          <option value="{{ key }}" 
              {% if request.GET.bedrooms == key|stringformat:"s" %}selected{% endif %}
              class="bg-white text-gray-700 hover:bg-gray-200">
              {{ value }}
          </option>
          {% endfor %}
      </select>
      </div>

      <!-- Submit -->
      <div>
        <button type="submit" class="bg-secondary hover:bg-lime-600 text-white font-semibold rounded-lg px-5 py-3 transition">
          Filter
        </button>
      </div>
    </form>
  </div>
</section>

<!-- CAROUSEL + FILTER FORM - MOBILE -->
<section class="relative sm:hidden w-full mb-72">
  <!-- Carousel Wrapper -->
  <div class="relative ">
    <!-- Carousel Images -->
    <div class="carousel overflow-hidden h-32 relative ">
      <!-- Example carousel slides -->
      <div class="carousel-inner-mobile flex transition-transform duration-700 ease-in-out" style="transform: translateX(0%)">
        {% for ad in ads %}
        {%if ad.url %}
          <a href="{{ad.url}}" class=" w-full">
            <img class="w-full flex-shrink-0 object-cover" src="{{ad.file_path}}" alt="">
          </a>
        {%else%}
          <img class="w-full flex-shrink-0 object-cover" src="{{ad.file_path}}" alt="">
        {%endif%}
        {% endfor %}
        {% comment %} <img src="https://plus.unsplash.com/premium_photo-1747810780928-8f512b6a2e94?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="City Buildings" class="w-full flex-shrink-0 object-cover"> {% endcomment %}
      </div>
    </div>

    <!-- Filter form overlaid horizontally on carousel -->
    <form method="GET" action="{% url 'listings' %}" 
          class=" absolute top-20 left-1/2 -translate-x-1/2 bg-white bg-opacity-90 rounded-xl shadow-lg flex flex-col gap-3 py-3 px-4 border w-[90%] mx-auto">
      <!-- City -->
      <div class="flex-1 min-w-[120px]">
        <label for="city" class="block text-sm font-semibold text-lime-700 mb-1">City</label>
        <select id="city" name="city" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white py-2 text-gray-400 ">City</option>
          {% for city in cities %}
          <option value="{{ city }}"
           {% if request.GET.city == city|stringformat:"s" %}selected{% endif %}
           class="bg-white text-gray-700 hover:bg-gray-200">{{ city }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Subcity -->
      <div class="flex-1 min-w-[120px]">
        <label for="subcity" class="block text-sm font-semibold text-lime-700 mb-1">Subcity</label>
        <select id="subcity" name="subcity" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white py-2 text-gray-400 ">Subcity</option>
          {% for subcity in subcities %}
          <option value="{{ subcity }}" 
           {% if request.GET.subcity == subcity|stringformat:"s" %}selected{% endif %}
           class="bg-white hover:bg-gray-200 {% if request.GET.subcity == subcity|stringformat:"s" %}text-black {% else %} text-gray-700 {% endif %}er:bg-gray-200 ">{{ subcity }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Price Range -->
      <div class="flex-1 min-w-[140px]">
        <label for="price" class="block text-sm font-semibold text-lime-700 mb-1">Max Price</label>
        <select id="price" name="price" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white text-gray-400 hover:bg-gray-200">Price range</option>
          {% for key, value in price_ranges.items %}
          <option value="{{ key }}"
           {% if request.GET.price == key|stringformat:"s" %}selected{% endif %} 
           class="bg-white text-gray-700 hover:bg-gray-200">{{ value }}</option>
          {% endfor %}
        </select>
      </div>


      <!-- Bedrooms -->
      <div class="flex-1 min-w-[100px]">
        <label for="bedrooms" class="block text-sm font-semibold text-lime-700 mb-1">Bedrooms</label>
        <select id="price" name="bedrooms" class="custom-select w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
          <option value="" class="bg-white text-gray-400 hover:bg-gray-200">Bedrooms</option>
          {% for key, value in bedrooms.items %}
          <option value="{{ key }}" 
              {% if request.GET.bedrooms == key|stringformat:"s" %}selected{% endif %}
              class="bg-white text-gray-700 hover:bg-gray-200">
              {{ value }}
          </option>
          {% endfor %}
        </select>
      </div>

      <!-- Submit -->
      <div>
        <button type="submit" class="bg-secondary w-full hover:bg-lime-600 text-white font-semibold rounded-lg px-5 py-2 transition">
          Filter
        </button>
      </div>
    </form>
  </div>
</section>

<!-- LISTINGS CARDS -->
<section class=" mx-auto px-4 sm:px-6 lg:px-14  mt-10 mb-16">
  <h2 class="text-3xl font-bold text-lime-700 mb-6 text-center">Available Rentals</h2>
  {% comment %} <div class="mt-10">
  <div class=" mt-5 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5  gap-4 mx-auto">
      {% for listing in listings%}
          {% include './listing_card.html' with listing=listing %}
      {% endfor %}
  </div>
</div> {% endcomment %}
  <div class="grid grid-cols-1 sm:grid-cols-2  lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {% for listing in listings %}
      {% include './listing_card.html' with listing=listing %}
    {% empty %} 
    <p class="col-span-full text-center text-gray-500">No listings found matching your criteria.</p>
    {% endfor %}
  </div>
</section>



      <!-- Pagination -->
 {%if listings|length > 1 %}
 <div class="mt-10 px-4 sm:px-6 lg:px-14 flex justify-center ">
  <div class=" rounded-full py-2 px-2 shadow-sm inline-flex w-auto max-w-full">
   <nav aria-label="Page navigation">
     <ul class="pagination justify-center items-center flex gap-2"> 
       {% if page_obj.has_previous %}
       {% comment %} <li class="page-item"><a class="page-link " href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">First</a></li> {% endcomment %}
       <li class="page-item border w-10 h-10 rounded-full shadow-sm flex items-center justify-center"><a class="page-link text-xl" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"><i class="fa fa-angle-left" aria-hidden="true"></i></a></li>
       {% endif %}  

       <!-- <div class=" flex gap-5"> -->
        {% for i in page_obj.paginator.page_range %}
       {% if i >= page_obj.number|add:'-5' and i <= page_obj.number|add:'5' %}
       
       <a class="page-link " href="?page={{ i }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"><li class=" p-2 rounded-full shadow-sm w-10 h-10 flex items-center justify-center  {% if i == page_obj.number %} bg-secondary shadow-sm text-white {%else%} border  {% endif %}">{{i}}</li></a>
       {% endif %}
       {% endfor %} 
       <!-- </div> -->
       
       {% if page_obj.has_next %}
       <li class="page-item border w-10 h-10 rounded-full shadow-sm flex items-center justify-center"><a  class="page-link text-xl" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"><i class="fa fa-angle-right" aria-hidden="true"></i></a></li>
       {% comment %} <li class="page-item"><a class="page-link " href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Last</a></li> {% endcomment %}
       {% endif %} 
     </ul>
   </nav>
  </div>
 </div>
 {%endif%}

 <div class=" px-4 sm:px-6 lg:px-14 mt-20">
  <form action="{% url 'comment-create' %}" method="POST" class=" flex flex-col gap-2 lg:w-[30rem] mx-auto">
    {% csrf_token %}
    <textarea class=" rounded outline-none focus:ring-2 focus:ring-lime-500 border focus:border-lime-500 " maxlength="500" rows="3" cols="40" name="content" id="comment" placeholder="Please take a moment to share your thoughts on this website"></textarea>
    <button type="submit" class=" bg-secondary text-white hover:bg-lime-600 duration-300 focus:ring-2 focus:ring-lime-300 p-2 py-3 rounded">
        <i class="fa fa-comment" aria-hidden="true"></i>
        submit
    </button>
  </form>
 </div>
 


 
<script>
    // Simple Carousel Logic (basic auto slide)
    const carouselInner = document.querySelector('.carousel-inner');
    const carouselInnerMob = document.querySelector('.carousel-inner-mobile');
    const totalSlides = carouselInner.children.length;
    let currentIndex = 0;

    function showSlide(index) {
      carouselInner.style.transform = `translateX(-${index * 100}%)`;
      carouselInnerMob.style.transform = `translateX(-${index * 100}%)`;
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % totalSlides;
      showSlide(currentIndex);
    }

    setInterval(nextSlide, 5000);
</script>



{% endblock content%}
